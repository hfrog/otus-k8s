name: k8s-cluster
on:
- workflow_dispatch
jobs:
  prepare-vms-for-k8s:
    runs-on: ubuntu-20.04
    steps:
    - uses: actions/checkout@v4
    - run: scripts/awscli_install.sh
      env:
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
    - run: scripts/prepare_vms_for_k8s.sh
      env:
        SSH_PRIVATE_KEY: |
          ${{ secrets.SSH_PRIVATE_KEY }}
        BUCKET: ${{ secrets.BUCKET }}
        K8S_VERSION: ${{ vars.K8S_VERSION }}

#  kubeadm-init:
#    runs-on: ubuntu-20.04
#    steps:
#    - uses: actions/checkout@v4
#    - run: scripts/awscli_install.sh
#      env:
#        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
#        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#    - run: scripts/kubeadm_init.sh
#      env:
#        BUCKET: ${{ secrets.BUCKET }}


#  apply:
#    needs: plan
#    runs-on: ubuntu-20.04
#    environment:
#      name: manual
#    steps:
#    - uses: actions/checkout@v4
#    - run: scripts/terraform_install.sh
#    - run: scripts/terraform_init.sh
#      env:
#        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
#        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#        BUCKET: ${{ secrets.BUCKET }}
#    - run: scripts/terraform_apply.sh
#      env:
#        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
#        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#        BUCKET: ${{ secrets.BUCKET }}
#        SSH_KEYS: ${{ secrets.SSH_KEYS }}
#        YC_TOKEN: ${{ secrets.YC_TOKEN }}
